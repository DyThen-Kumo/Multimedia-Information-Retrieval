{% extends "base.html" %}

{% block tab %}
  <!--Tab-->
  <ul class="nav nav-tabs justify-content-center">
    <li class="nav-item", style="background-color: #95D4FA;">
      <a class="nav-link" href="{{ url_for('render_generative_text') }}">Generative Text</a>
    </li>
    <li class="nav-item", style="background-color: #95D4FA;">
      <a class="nav-link active" aria-current="page" href="{{ url_for('render_generative_image') }}">Generative Image</a>
    </li>
  </ul>
{% endblock %}
{% block content %}
  <!--Search-->
  <div class="container search">
    <!--Header-->
    <h1 class="my-4 text-center" style="color: #FCCCFC; text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;">REGULAR SEARCH</h1>
    <!--Form Input-->
    <form id="imageForm">
      <div class="form-group mb-3">
        <label>Enter some parameters:</label>
        <!-- <div class="form-group d-flex">
          <input type="number" class="form-control mr-3" id="InputNumberImages" placeholder="Number of Images">
          <input type="text" class="form-control" id="InputSubmitName" placeholder="Name of submit file">
        </div> -->
        <input type="file" class="form-control mr-3" id="InputImage" name="InputImage" placeholder="Upload image">
        <button type="submit" class="btn btn-primary">Search</button>
      </div>
    </form>
    <div class="image-container row" id="imageContainer"></div>
    <!--Confirm Button-->
    <div class="confirm-container">
      <button id="confirmButton" class="btn btn-success">Confirm</button>
      <button id="deleteButton" class="btn btn-success">Delete</button>
    </div>
  </div>

  <!--Double Click to zoom in Image-->
  <div id="myModal" class="modal">
    <span class="close">&times;</span>
    <div class="modal-content" id="modalContent"></div>
  </div>
  
  <!--Code hiện ảnh-->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script>
    $(document).ready(function() {
      $('#imageForm').submit(function(event) {
        event.preventDefault();

        const formData = new FormData();
        // formData.append('num_images', $('#InputNumberImages').val());
        // formData.append('submit_name', $('#InputSubmitName').val());
        formData.append('image', $('#InputImage')[0].files[0]);
        
        $.ajax({
            url: '/get-generative-images',
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function(data) {
              const imageContainer = $('#imageContainer');
              imageContainer.empty();
              if (data.error) {
                alert(data.error);
              } else {
                data.forEach(function(urls) {
                  const url = urls.replace('D:\\CLB-AI\\AIC2024\\', ''); // Xóa static/ khỏi đường dẫn
                  // const colDiv = $('<div>'); // 5 hình ảnh trên mỗi hàng
                  const img = $('<img>').attr('src', url);
                  // const checkbox = $('<input>').attr('type', 'checkbox').attr('value', imgName);
                  // const infoDiv = $('<div>').addClass('image-info').append(checkbox).append($('<span>').text(imgName));
                  // colDiv.append(img);
                  imageContainer.append(img);
                });
              }
            }
        });
      });
      // Click phóng to ảnh
      $(document).on('dblclick', '.image-container img', function() {
        const src = $(this).attr('src');
        $('#modalContent').html('<img src="' + src + '">');
        $('#myModal').css('display', 'block');
      });
  
      $('#myModal').click(function() {
        $(this).css('display', 'none');
      });

      // Click confirm, gửi tên file về sever.
      $('#confirmButton').click(function() {
        const selectedImages = [];
        $('#imageContainer input[type="checkbox"]:checked').each(function() {
          selectedImages.push($(this).val());
        });
        const submitName = $('#InputSubmitName').val();

        // Gửi danh sách các đường dẫn đã chọn đến server hoặc xử lý theo nhu cầu
        console.log('Selected Images:', selectedImages);
        console.log('Submit File Name:', submitName);
        $.post('/confirm_selection', { selected_images: selectedImages, submit_file_name: submitName}, function(response) {
          alert('Selection confirmed!');
          console.log(response);
        });
      });
        // Click delete, xoá ảnh.
      $('#deleteButton').click(function() {
        $('#imageContainer').empty()
      });
    });
  </script>
{% endblock %}